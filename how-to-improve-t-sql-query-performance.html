<!DOCTYPE html><html lang="en-ca"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>How to improve T-SQL query performance - CafeSql</title><meta name="description" content="T-SQL (Transact-SQL) is a dialect of SQL that is used to interact with Microsoft SQL Server databases. It allows you to write queries that can manipulate data, create tables, views, stored procedures, functions, triggers and more. However, writing efficient and performant T-SQL queries can be&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://pollusb.github.io/cafesql.github.io/how-to-improve-t-sql-query-performance.html"><link rel="alternate" type="application/atom+xml" href="https://pollusb.github.io/cafesql.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://pollusb.github.io/cafesql.github.io/feed.json"><meta property="og:title" content="How to improve T-SQL query performance"><meta property="og:site_name" content="CafeSql"><meta property="og:description" content="T-SQL (Transact-SQL) is a dialect of SQL that is used to interact with Microsoft SQL Server databases. It allows you to write queries that can manipulate data, create tables, views, stored procedures, functions, triggers and more. However, writing efficient and performant T-SQL queries can be&hellip;"><meta property="og:url" content="https://pollusb.github.io/cafesql.github.io/how-to-improve-t-sql-query-performance.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://pollusb.github.io/cafesql.github.io/assets/css/style.css?v=ad994e06fe4ccf9aa9bbf0f25d02eaf2"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://pollusb.github.io/cafesql.github.io/how-to-improve-t-sql-query-performance.html"},"headline":"How to improve T-SQL query performance","datePublished":"2023-03-16T16:01","dateModified":"2023-03-16T21:36","description":"T-SQL (Transact-SQL) is a dialect of SQL that is used to interact with Microsoft SQL Server databases. It allows you to write queries that can manipulate data, create tables, views, stored procedures, functions, triggers and more. However, writing efficient and performant T-SQL queries can be&hellip;","author":{"@type":"Person","name":"Pollus","url":"https://pollusb.github.io/cafesql.github.io/authors/pollus/"},"publisher":{"@type":"Organization","name":"Pollus"}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://pollusb.github.io/cafesql.github.io/">CafeSql</a></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2023-03-16T16:01">March 16, 2023</time></div><h1>How to improve T-SQL query performance</h1><div class="post__meta post__meta--author"><a href="https://pollusb.github.io/cafesql.github.io/authors/pollus/" class="feed__author">Pollus</a></div></div></header></div><div class="wrapper post__entry"><p>T-SQL (Transact-SQL) is a dialect of SQL that is used to interact with Microsoft SQL Server databases. It allows you to write queries that can manipulate data, create tables, views, stored procedures, functions, triggers and more. However, writing efficient and performant T-SQL queries can be challenging and requires some knowledge and skills. In this blog post, I will share some tips and best practices on how to optimize your T-SQL queries and improve their performance.</p><h2 id="1-use-indexes-wisely">1. Use indexes wisely</h2><p>An index is a data structure that helps SQL Server find data faster by organizing it in a sorted order. Indexes can speed up your queries by reducing the number of pages that need to be scanned or read from disk. However, indexes also have some drawbacks: they consume disk space, they need to be maintained when data changes (which can cause overhead), and they can affect the performance of insert, update and delete operations.</p><p>Therefore, you should use indexes wisely and only create them on columns that are frequently used in query predicates (such as WHERE, JOIN, ORDER BY or GROUP BY clauses). You should also avoid creating too many indexes on the same table or overlapping indexes that cover the same columns. As a best practice, most selective columns (those that have more distinct values) should be placed leftmost in the key of a non-clustered index.</p><p>To find out which indexes are useful or unused for your queries, you can use tools such as <strong>Database Engine Tuning Advisor</strong> or <strong>Query Store</strong>. These tools can analyze your workload and suggest optimal indexes based on various factors such as query frequency, cost and impact.</p><h2 id="2-avoid-unnecessary-joins">2. Avoid unnecessary joins</h2><p>A join is an operation that combines data from two or more tables based on a common column or condition. Joins are essential for relational databases but they can also be expensive in terms of performance. The more tables you join, the more complex the query becomes and the more resources it consumes.</p><p>Therefore, you should avoid unnecessary joins whenever possible and only join tables that provide relevant information for your query result. You should also choose the appropriate join type for your scenario: inner join (returns only matching rows from both tables), left outer join (returns all rows from the left table plus matching rows from the right table), right outer join (returns all rows from the right table plus matching rows from the left table) or full outer join (returns all rows from both tables).</p><p>To optimize your joins further, you can use techniques such as:</p><ul><li>Filtering data before joining: use WHERE clauses to eliminate unwanted rows from each table before joining them</li><li>Reducing data size: use SELECT clauses to select only necessary columns from each table instead of selecting all columns (*)</li><li>Using derived tables: use subqueries to create temporary tables that contain only relevant data for joining</li><li>Using common table expressions (CTEs): use CTEs to define reusable expressions that can simplify complex queries involving multiple joins</li><li>Using indexed views: use indexed views to pre-compute frequently joined data sets and store them as physical objects with indexes</li></ul><h2 id="3-use-set-based-operations-instead-of-cursors-or-loops">3. Use set-based operations instead of cursors or loops</h2><p>T-SQL supports both set-based operations and procedural logic such as cursors or loops. Set-based operations are those that operate on a whole set of rows at once using SQL statements such as SELECT, INSERT, UPDATE or DELETE. Procedural logic is those that operate on one row at a time using control flow statements such as WHILE, FOR or IF.</p><p>Set-based operations are usually faster than procedural logic because they leverage SQL Serverâ€™s ability to process data in bulk using optimized algorithms and parallelism. Procedural logic often involves row-by-row processing which can cause high CPU usage, memory consumption and disk I/O.</p><p>Therefore, you should prefer set-based operations over procedural logic whenever possible and avoid using cursors or loops unless absolutely necessary. If you need to use cursors or loops for some reason, you should try to minimize their impact by:</p><ul><li>Declaring cursors as local instead of global</li><li>Choosing cursor types carefully based on their characteristics (forward-only vs scrollable, static vs dynamic vs keyset-driven)</li><li>Closing cursors explicitly when done</li><li>Using batch updates instead of single-row updates</li><li>Limiting loop iterations by using break conditions</li></ul><h2 id="4-use-parameters-instead-of-literals">4. Use parameters instead of literals</h2><p>Parameters are placeholders</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on March 16, 2023</p><ul class="post__tag"><li><a href="https://pollusb.github.io/cafesql.github.io/tags/sqlserver/">sqlserver</a></li></ul><div class="post__share"></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://pollusb.github.io/cafesql.github.io/authors/pollus/" rel="author">Pollus</a></h3></div></div></footer></article></main><footer class="footer"><div class="footer__copyright"><p>Powered by Publii</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://pollusb.github.io/cafesql.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://pollusb.github.io/cafesql.github.io/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>